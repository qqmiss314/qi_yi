
<!doctype html>
<html  lang="en">

    <head>
        <!-- meta data -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

        <!--font-family-->
		<link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&amp;subset=devanagari,latin-ext" rel="stylesheet">
        
        <!-- title of site -->
        <title>Sign up</title>

        <!-- For favicon png -->
		<link rel="shortcut icon" type="image/icon" href="/static/logo/favicon.png"/>
       
        <!--font-awesome.min.css-->
        <link rel="stylesheet" href="/static/css/font-awesome.min.css">
		
		<!--animate.css-->
        <link rel="stylesheet" href="/static/css/animate.css">
		
        <!--bootstrap.min.css-->
        <link rel="stylesheet" href="/static/css/bootstrap.min.css">
		
		<!-- bootsnav -->
		<link rel="stylesheet" href="/static/css/bootsnav.css" >	
        
        <!--style.css-->
        <link rel="stylesheet" href="/static/css/style.css">
        
        <!--responsive.css-->
        <link rel="stylesheet" href="/static/css/responsive.css">

        
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		
        <!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>

        <![endif]-->
        <script src="/static/js/jquery.js"></script>
         <link rel="stylesheet" type="text/css" href="/static/css/jquery.gritter.css" />
        <script type="text/javascript" src="/static/js/jquery.gritter.js"></script>
    </head>
	
	<body>
		<!--[if lte IE 9]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
        <![endif]-->
		
		<!-- signin end -->
		<section class="signin signup">
			<div class="container">

				<div class="sign-content">
					<h2>注册</h2>
					
					<div class="row">
						<div class="col-sm-12">
							<div class="signin-form">
								<form action="" id="register_form">
                                    {% csrf_token %}
									<div class="form-col">

									</div><!--/.form-col -->


									<div class="form-group">
										<label for="signin_form">邮箱</label>
{#									    <input type="email" class="form-control" id="signin_form" placeholder="请输入正确邮箱">#}
                                         {{ form.username }}
									</div><!--/.form-group -->
									<div class="form-group">
										<label for="signin_form">密码</label>
{#									    <input type="password" class="form-control" id="signin_form" placeholder="密码">#}
                                         {{ form.password }}
									</div><!--/.form-group -->
									<div class="form-group">
										<label for="signin_form">确认密码</label>
{#									    <input type="password" class="form-control" id="signin_form" placeholder="确认密码">#}
                                         {{ form.password2 }}
									</div><!--/.form-group -->
                                    <div class="form-group">
										<label for="signin_form">手机号</label>
{#									    <input type="password" class="form-control" id="signin_form" placeholder="确认密码">#}
                                         {{ form.mobile }}
									</div><!--/.form-group -->
                                     <div class="form-group">
										<label for="signin_form">验证码</label>
{#									    <input type="password" class="form-control" id="signin_form" placeholder="确认密码">#}
                                         {{ form.mobile_captcha }}
                                         <input onclick="sendmessage(this,60);" type="button" value="发送短信"  class="btn btn-info" style="height:38px;width: 125px;"/>
									</div><!--/.form-group -->
                                    	<div class="row">
						<div class="col-sm-12">
							<div class="signin-footer">
								<button type="button" class="btn signin_btn" data-toggle="modal" data-target=".signin_modal" id="register_btn">
								注册							</button>
								<p>
									已经是会员 ?
									<a href="{% url 'accounts:login' %}">登录</a>								</p>
							</div><!--/.signin-footer -->
						</div><!--/.col-->
					</div><!--/.row -->
								</form><!--/form -->
							</div><!--/.signin-form -->
						</div><!--/.col -->
					</div><!--/.row -->
					
{#					<div class="row">#}
{#						<div class="col-sm-12">#}
{#							<div class="signin-password">#}
{#								<div class="awesome-checkbox-list">#}
{#									<ul class="unstyled centered">#}
{##}
{#										<li>#}
{#										    <input class="styled-checkbox" id="styled-checkbox-2" type="checkbox" value="value2">#}
{#										    <label for="styled-checkbox-2" >接受注册协议</label>#}
{#										</li>#}
{##}
{#										<li></li>#}
{#									</ul>#}
{#								</div><!--/.awesome-checkbox-list -->#}
{#							</div><!--/.signin-password -->#}
{#						</div><!--/.col -->#}
{#					</div><!--/.row -->#}


{#					<div class="row">#}
{#						<div class="col-sm-12">#}
{#							<div class="signin-footer">#}
{#								<button type="button" class="btn signin_btn" data-toggle="modal" data-target=".signin_modal" id="register_btn">#}
{#								注册							</button>#}
{#								<p>#}
{#									已经是会员 ?#}
{#									<a href="{% url 'accounts:login' %}">登录</a>								</p>#}
{#							</div><!--/.signin-footer -->#}
{#						</div><!--/.col-->#}
{#					</div><!--/.row -->#}
				</div><!--/.sign-content -->

				<!-- modal part start -->

			</div><!--/.container -->
		</section><!--/.signin -->

		<!-- signin end -->

		<!--footer copyright start -->
		<footer class="footer-copyright">
			<div id="scroll-Top">
				<i class="fa fa-angle-double-up return-to-top" id="scroll-top" data-toggle="tooltip" data-placement="top" title="" data-original-title="Back to Top" aria-hidden="true"></i>			</div><!--/.scroll-Top-->
		</footer><!--/.hm-footer-copyright-->
		<!--footer copyright  end -->


		 <!-- Include all js compiled plugins (below), or include individual files as needed -->


        
        <!--modernizr.min.js-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
		
		<!--bootstrap.min.js-->
        <script src="/static/js/bootstrap.min.js"></script>
		
		<!-- bootsnav js -->
		<script src="/static/js/bootsnav.js"></script>
		
		<!-- jquery.sticky.js -->
		<script src="/static/js/jquery.sticky.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
		
        
        <!--Custom JS-->
        <script src="/static/js/custom.js"></script>
     <script>
        {# 发送短信验证码 #}
        function sendmessage(obj,second){
            var telRegex = /(13|14|15|17|18)\d{9}/;
            if(telRegex.test($.trim($("#id_mobile").val()))){
                $.ajax({
                    url: "{% url 'apis:mobile_captcha' %}",
                    type: "GET",
                    dataType: "json",
                    data: {"mobile": $("#id_mobile").val()},
                    success: function (data) {
                         $.gritter.add({
                            // (string | mandatory) the heading of the notification
                            title: '提交结果',
                            // (string | mandatory) the text inside the notification
                          //text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" style="color:#ccc">magnis dis parturient</a> montes, nascetur ridiculus mus.'
                            text: data.msg
                        });
                    }
                });
                countDown(obj,second)
            } else{
                $.gritter.add({
                    // (string | mandatory) the heading of the notification
                    title: '提交结果',
                    // (string | mandatory) the text inside the notification
                    //text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" style="color:#ccc">magnis dis parturient</a> montes, nascetur ridiculus mus.'
                    text: '手机号有误'
                });
            }
        }

        {# 重新发送倒计时 #}
        function countDown(obj,second){
        // 如果秒数还是大于0，则表示倒计时还没结束
         if(second>=0){
              // 获取默认按钮上的文字
              if(typeof buttonDefaultValue === 'undefined' ){
                buttonDefaultValue =  obj.defaultValue;
            }
            // 按钮置为不可点击状态
            obj.disabled = true;
            // 按钮里的内容呈现倒计时状态
            obj.value = buttonDefaultValue+'('+second+')';
            // 时间减一
            second--;
            // 一秒后重复执行
            setTimeout(function(){countDown(obj,second);},1000);
            // 否则，按钮重置为初始状态
            }else{
            // 按钮置未可点击状态
            obj.disabled = false;
            // 按钮里的内容恢复初始状态
            obj.value = buttonDefaultValue;
           }
        }
    $("#register_btn").click(function () {
          // some_check
          $.ajax({
              url: "{% url 'accounts:register' %}",
              type: "POST",
              dataType: "json",
              data: $("#register_form").serialize(), // {"username":'cali'}
              success: function (data) {
                  if(data.status == 200 ){
                      window.location.href='{% url 'repo:index' %}';
                  }else{
                      msg = "新错误类型";
                      if(data.status == 400 || data.status == 401){
                          msg = data.msg
                      }else{
                          // 402 => form.errors
                          for(var i in data.msg){
                              msg = i+data.msg[i];
                              break
                          }
                      }
                       $.gritter.add({
                          // (string | mandatory) the heading of the notification
                          title: '提交结果',
                          // (string | mandatory) the text inside the notification
                          //text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" style="color:#ccc">magnis dis parturient</a> montes, nascetur ridiculus mus.'
                          text: msg
                      });
                   }
              },
              // 解决csrftoken
              beforeSend: function(xhr, settings) {
                  xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
              }
          });
      });
    </script>
    </body>
</html>